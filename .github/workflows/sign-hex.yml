
name: Sign HEX File

on:
  workflow_dispatch:
    inputs:
      oem:
        description: 'OEM Name (e.g., oem1, oem2)'
        required: true
      hex_file:
        description: 'Path to HEX file (optional if auto-triggered)'
        required: false

jobs:
  sign:
    runs-on: windows-latest

    steps:
      - name: Checkout Project_Repo
        uses: actions/checkout@v4

      - name: Checkout private signer-repo
        uses: actions/checkout@v4
        with:
          repository: priyapriya2/signer-repo
          path: signer-repo
          token: ${{ secrets.PRIVATE_REPO_PAT }}
          
      - name: Determine HEX file path
        id: findhex
        run: |
            echo "HEX_FILE=${{ github.event.inputs.hex_file }}" >> $env:GITHUB_ENV
              

      - name: Sign HEX file
        run: |
          $signer = "signer-repo\\tools\\Signingkey.exe"
          $keyFile = "signer-repo\\keys\\private.key"
          $signatureFile = "signature.sig"

          & $signer $env:HEX_FILE $keyFile $signatureFile
          

      - name: Upload signature artifact
        uses: actions/upload-artifact@v4
        with:
          name: hex_signature
          path: signature.sig
